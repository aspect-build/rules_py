load("//py:defs.bzl", "py_binary")

# Inline the syntax-sugar produced by the entry_point() helper in rules_python,
# declaring our own binary that directly invokes a third-party entry point.
# We happen to use pytest here only for convenience, as it's a program already in our requirements.in.
py_binary(
    name = "py_test_bin",
    srcs = ["@pypi_pytest//:rules_python_wheel_entry_point_pytest"],
    # rules_python permits this label even though it's not a source file in this repository.
    main = "rules_python_wheel_entry_point_pytest.py",
    deps = ["@pypi_pytest//:pkg"],
)

genrule(
    name = "run_py_test_help",
    outs = ["help.txt"],
    cmd = "$(execpath py_test_bin) --help >$@",
    tools = ["py_test_bin"],
)
