import %workspace%/bazel/defaults.bazelrc

common --test_output=errors
common --incompatible_disallow_empty_glob=False

# Define value used by tests
common --define=SOME_VAR=SOME_VALUE

# Set the default virtualenv to 'default'
common --@pypi//venv=aspect_rules_py

common --incompatible_enable_cc_toolchain_resolution
common --@toolchains_llvm_bootstrapped//config:experimental_stub_libgcc_s
common --@rules_cc//cc/toolchains/args/archiver_flags:use_libtool_on_macos=false

# TODO(bzlmod): Don't break proto
common --per_file_copt=external/.*protobuf.*@--PROTOBUF_WAS_NOT_SUPPOSED_TO_BE_BUILT
common --host_per_file_copt=external/.*protobuf.*@--PROTOBUF_WAS_NOT_SUPPOSED_TO_BE_BUILT

# Don't try and auto detect the cc toolchain, as we use our own llvm toolchains.
common --repo_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
common --repo_env=BAZEL_NO_APPLE_CPP_TOOLCHAIN=1

common:ci --toolchain_resolution_debug='@@bazel_tools//tools/cpp:toolchain_type'

common:release --build_tag_filters=release
common:release --stamp
common:release --compilation_mode=opt
common:release --@rules_rust//rust/settings:lto=fat
common:release --@rules_rust//:extra_rustc_flags=-Cpanic=abort

# Load any settings specific to the current user.
# .bazelrc.user should appear in .gitignore so that settings are not shared with team members
# This needs to be last statement in this
# config, as the user configuration should be able to overwrite flags from this file.
# See https://docs.bazel.build/versions/master/best-practices.html#bazelrc
# (Note that we use .bazelrc.user so the file appears next to .bazelrc in directory listing,
# rather than user.bazelrc as suggested in the Bazel docs)
try-import %workspace%/.bazelrc.user
